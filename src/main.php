<?php

require  __DIR__ . "/../vendor/autoload.php";
use App\Firm;
use App\Score;
use App\Scrap;

include 'phpWhoisClass/src/whois.main.php';

//$arr= array( "27418065", "28271866", "40229955", "27407446", "63144361", "25941763", "27889734", "28261712", "28572599", "25815326", "27887626", "28496086", "26242761", "28307569", "27368386", "60278706", "27911624", "27311511", "28780671", "25236431", "28955676", "28987616", "27922821", "63672448", "46343768", "28351045", "27485391", "29269555", "24252310", "27499723", "27251802", "67798641", "26271061", "27126447", "24687332", "26250802", "26050650", "28442458", "26895820", "27334929", "26300176", "41325231", "60111500", "28191331", "49284380", "13585363", "28331273", "25454455", "29099528", "46342745", "27803571", "25692089", "26485524", "45195129", "26230224", "25993038", "15503224", "25250507", "25035428", "11540508", "27650952", "67282385", "24826405", "28265891", "28239300", "04434234", "26931711", "26038536", "05833779", "25379798", "25859668", "61509361", "24131199", "03245225", "26180588", "47543850", "25914235", "25175939", "27546047", "49369423", "47453737", "26307375", "27748235", "25907077", "27199983", "25816888", "28300785", "28078993", "27455378", "27502945", "27206572", "27813479", "25921100", "27735354", "28245954", "62620444", "28101308", "28314620", "26781832", "27784487", "61064831", "01627368", "14891981", "29180945", "29025826", "04097131", "28360451", "27731073", "26213711", "27656691", "28996798", "60611405", "27775640", "08327301", "26064901", "05690021", "04508785", "04186168", "24205443", "62909207", "06376401", "07857918", "28430514", "25672703", "02811561", "03457338", "02644568", "24776742", "62586254", "25139886", "26013118", "28570880", "46903470", "49967959", "46981896", "28262239", "28509676", "27715655", "15053881", "60740191", "27736814", "41324731", "27175171", "25931326", "49062557", "28263383", "45281521", "04015797", "26839172", "03213293", "24252719", "29459699", "03431991", "60108703", "03776859", "27467911", "28088280", "26964333", "27792803", "27824012", "26850320", "26013151", "28571339", "27779084", "27550532", "29294339", "24144215", "28702948", "28276566", "61465291", "29082269", "27759920", "27808394", "27748227", "28522818", "25480855", "26146657", "25531603", "26117177", "03076849", "03185745", "28815769", "24137804", "27839974", "26242923", "61858307", "27879496", "01659227", "28586310", "28605951", "24710164", "24149811", "27525228", "63216167", "25378341", "28327519", "49432621", "26189127", "25210106", "25618733", "26161109", "26898241", "26259419", "25095650", "48026204", "43389996", "25297325", "62415956", "25396081", "25422375", "29306400", "49285351", "62525751", "28637305", "27945944", "25022962", "25932667", "47122889", "48909769", "24801461", "10264281", "28772172", "27500217", "25564501", "28467272", "27165086", "27813444", "27428745", "48399311", "49435019", "27222233", "27839583", "27903150", "28671601", "24700738", "29003385", "25858891", "25387677", "27715272", "25401378", "27760766", "26897547", "26694484", "28333837", "28947631", "49826433", "28469330", "28189086", "29228743", "27816192", "27746976", "44264747", "48398071", "25682598", "26791617", "29388163", "27171701", "49243705", "29021413", "28952537", "25344340", "27386830", "27088782", "63319675", "28689216", "28360117", "49684175", "27479145", "27526631", "45146110", "26971259", "44041713", "64053482", "48583979", "46708855", "26024951", "18757537", "25664689", "25628992", "47908718", "29192773", "28479289", "28599098", "26316315", "26921979", "25500767", "27881237", "25300989", "27717097", "24749265", "28408250", "26815028", "22859373", "25925342", "27981274", "25531816", "29199069", "03373771", "24721042", "27685802", "03733823", "24119768", "26694913", "60723921", "60794429", "28672500", "27545474", "24813796", "18198791", "62917455", "28280113", "25974939", "63986337", "26847264", "47911247", "27313298", "25568469", "28310403", "64050211", "28675312", "28515803", "28050568", "29017190", "25675893", "25944711", "26229994", "62908499", "28509480", "28187181", "28495870", "25681940", "12645877", "28332971", "44847807", "26241226", "26945738", "25862391", "24663379", "28786629", "25263633", "28294777", "28874323", "28576772", "27879941", "27943763", "25613316", "28614488", "28790146", "27894690", "25372572", "24829315", "28259084", "26263556", "25110551", "27528812", "27416771", "47783443", "45797439", "28518756", "26297281", "15824926", "48907227", "15546624", "44005067", "42866472", "43833497", "25510584", "25877496", "42014638", "28183461", "29268761", "28165586", "26064812", "28242173", "29238820", "25390589", "24824526", "46506501", "28129504", "09568786", "09207619", "05472873", "41034554", "24159671", "25079832", "63076616", "24780481", "24267945", "29261864", "29460581", "29185084", "28820886", "28518616", "25844725", "28083440", "25932543", "27133834", "26239949", "28861621", "28460367", "25631781", "27605493", "25635808", "28377184", "27590291", "27310221", "25992481", "27204529", "26645955", "28186401", "28409302", "25529498", "26125072", "26743442", "28209079", "28408080", "25597001", "28776071", "47285869", "29181712", "43875092", "28112113", "27921450", "45349045", "26916801", "46993304", "27085431", "27325733", "26328828", "27468801", "26938596", "26813033", "28337638", "00176966", "25113208", "26236893", "25267876", "24765180", "28332822", "03897613", "45805270", "24724921", "24711411", "27762033", "26813025", "28880170", "63250501", "29188261", "28231210", "27801594", "25620991", "28637216", "26281813", "24778052", "44962738", "24801828", "26828294", "28343034", "24689459", "15553523", "63496321", "43003028", "63072572", "28325851", "28997891", "27221407", "27628736", "03974774", "27120180", "27807771", "26907780", "28575270", "27172554", "27830730", "09055142", "63988330", "27828735", "24784826", "27815307", "03089134", "45534535", "28789725", "28382650", "02548178", "28331125", "04395778", "63475600", "06706738", "02631962", "04240910", "00177041", "26185610", "45317054", "45274649", "24191736", "27114309", "26900483", "27539580", "62502484", "29031966", "24122068", "26958481", "64572251", "26192764", "28063601", "28132653", "29296862", "27722414", "27787893", "07320604", "06183140", "45786089", "28653432", "29002702", "28439635", "25966634", "28472241", "03908968", "25759116", "24768766", "28252268", "28303598", "28702123", "25036840", "26416051", "27804861", "28348656", "14546108", "27870171", "25568388", "27250652", "65276060", "63485931", "25226894", "28471610", "25932292", "25595351", "27660516", "26855976", "28111184", "27536092", "27353559", "15271455", "25531174", "24749877", "28417950", "44569530", "49687832", "60071052", "62968955", "27190323", "28677781", "27932206", "25583468", "28939832", "25342282", "40336638", "28284577", "26841886", "70982228", "26497671", "27746674", "22822925", "28712234", "29185742", "28162447", "25635522", "28304918", "60197501", "29033152", "28964314", "28116097", "29197520", "27911063", "25277588", "25352822", "45308624", "25918338", "25893165", "25471341", "43002820", "27526178", "29253934", "25439979", "27955257", "27851460", "27446174", "27847268", "62025163", "62967690", "00675008", "27510557", "46886508", "26799146", "25528815", "25666304", "28923944", "64824365", "25345893", "63488736", "02033267", "03917959", "24725447", "25325485", "46991778", "18827942", "26017989", "29113229", "26191091", "27336930", "28415507", "28193911", "64507289", "25472682", "65782607", "27660559", "65414349", "27914526", "27851338", "28175280", "27320766", "28403118", "25407775", "45274851", "28500679", "27650189", "26032635", "25255134", "26386763", "26909758", "27093565", "13694740", "28463421", "22842080", "28495179", "29054788", "46904816", "22828389", "28542754", "28318528", "27477169", "65348818", "24681555", "24739120", "22676295", "25364723", "24733351", "47718552", "47534257", "27591131", "24707996", "24718645", "24727555", "27655385", "27795411", "27776662", "02011620", "27473422", "26428725", "27353737", "25869108", "25627538", "26904195", "10349758", "26106191", "28937465", "45272930", "27176657", "28485432", "25189883", "25634933", "26427672", "25935895", "27186351", "26420261", "26026589", "25107232", "25589288", "60464402", "27674509", "03234894", "02518546", "29449936", "24223662", "24787213", "27980863", "26481782", "27527611", "49685449", "29238081", "46901906", "28086953", "27673740", "63672332", "25194933", "28094239", "28451619", "28273508", "27105776", "27320022", "28227760", "26358832", "25348655", "27424871", "47830662", "25866401", "48592692", "26205301", "26011441", "27820319", "27546004", "28687264", "25349112", "25988395", "28877756", "27433986", "28425618", "24731048", "29028566", "47909391", "26836475", "29080690", "29213592", "24775231", "28952227", "24778761", "29033713", "22691367", "24133311", "26363992", "28807014", "27446638", "24759406", "26213087", "64835359", "27932974", "29048770", "26839300", "28642716", "01610945", "04607236", "24729981", "08139059", "01903705", "25387383", "05569010", "28492099", "06106927", "27414191");

$array_atr=array("Nazev","ICO","Sidlo","Status(v likvidaci)","Pocet let na trhu","Pocet zamestnancu","Nespolehlivy platce","Pravni forma",
    "Rust zakladniho kapitala","Neduveryhodny vek jednatele","Pocet jednatelu","Bydleni mimo EU","Pocet jinych subjektu","Pocet jinych subjektu v likvidaci",
    "Dluzniky","Oz","Status domeny","Domena(let v provozu)","Jine subjekty na sidle","Volne nabidky prace","Test zakladni","Test jednatelu","Pocet provozoven",
    "Test samotneho subjekta","Test domeny","Test bonusovy","Vysledek");

//foreach ($arr as $qwe) {
//    $firma = strval($qwe);
//    print $firma."\n";
//
//    $result_array=array();
//    $scrap=new Scrap();
//   $result_array=$scrap->main_info($result_array,$qwe);
//    if(!isset($result_array['Status(v likvidaci)']))
//    {
//        continue;
//    }
//  //  if ($result_array['Status(v likvidaci)'] === 'NE' ) {

//        $result_array=$scrap->pocet_zamestnancu($result_array);
//        $result_array=$scrap->dph($result_array);
//        $result_array=$scrap->pravni_forma($result_array);
//        $result_array=$scrap->zakladni_kapital($result_array);
      //  $result_array=$scrap->people_info($result_array);
    //    $result_array=$scrap->bydleni_jednatelu($result_array);

  //         Firm::update_bydleni($result_array['Bydleni mimo EU'],$result_array['ICO']);

//        $result_array=$scrap->ochranne_znamky($result_array);
//        $result_array=$scrap->domena_info($result_array);
//
//        $whois = new Whois();
//        $result = $whois->Lookup($scrap->getDm());
//        $result_array=$scrap->whois_parser($result,$result_array);
//
//        $result_array=$scrap->pocet_provozoven($result_array);
//        $result_array=$scrap->jine_firmy_na_sidle($result_array);
//        $result_array=$scrap->nabidky_prace($result_array);
//    }
//
//    foreach ($array_atr as $item)
//    {
//        if(!isset($result_array[$item]))
//            $result_array[$item]=null;
//    }




//    Firm::createTable();
//    Firm::insertion($result_array['Nazev'],$result_array['ICO'],$result_array['Sidlo'],$result_array['Status(v likvidaci)'],
//    $result_array['Pocet let na trhu'],$result_array['Pocet zamestnancu'],$result_array['Pravni forma'],$result_array['Nespolehlivy platce'],
//    $result_array['Rust zakladniho kapitala'],$result_array['Pocet jednatelu'],$result_array['Neduveryhodny vek jednatele'],$result_array['Bydleni mimo EU'],
//    $result_array['Pocet jinych subjektu'],$result_array['Pocet jinych subjektu v likvidaci'],$result_array['Dluzniky'],$result_array['Oz'],
//    $result_array['Status domeny'],$result_array['Domena(let v provozu)'],$result_array['Pocet provozoven'],$result_array['Jine subjekty na sidle'],
//    $result_array['Volne nabidky prace'],$result_array['Test zakladni'],$result_array['Test jednatelu'],$result_array['Test samotneho subjekta'],
//    $result_array['Test domeny'],$result_array['Test bonusovy'],$result_array['Vysledek']);
//
//
//    $score=new Score();
//    $score->Zakladni_test_count($result_array['ICO']);
//    $score->Jednatelu_test_count($result_array['ICO']);
//    $score->Subjekt_test_count($result_array['ICO']);
//    $score->Domena_test_count($result_array['ICO']);
//    $score->Bonusovy_test_count($result_array['ICO']);
//    $score->Vysledek($result_array['ICO']);


  //   print_r($result_array);

//}


$array=Firm::findAll();
foreach ($array as $item)
{
    print $item."\n";
    $score=new Score();
    $score->Zakladni_test_count($item);
    $score->Jednatelu_test_count($item);
    $score->Subjekt_test_count($item);
    $score->Domena_test_count($item);
    $score->Bonusovy_test_count($item);
    $score->Vysledek($item);
}
